# Index.tsx リファクタリング・チェックリスト

## プロジェクト概要

- **目標**: 1785行の巨大なindex.tsxファイルを責務ごとに分割し、保守性とテスト可能性を向上させる
- **アプローチ**: 段階的なコンポーネント抽出とテスト追加
- **技術スタック**: Next.js 15.3.3, React, TypeScript, Vitest, Tailwind CSS

## 全体進捗管理

### 完了済みタスク ✅

- [x] **テスト環境のセットアップ**

  - [x] Vitest v3.1.4のインストールと設定
  - [x] React Testing Libraryの設定
  - [x] vitest.config.ts作成
  - [x] テストセットアップファイル作成
  - [x] package.jsonにテストスクリプト追加

- [x] **SupplementCard コンポーネント抽出**
  - [x] src/components/SupplementCard.tsx作成
  - [x] Props interfaceの定義
  - [x] JSXの移行（lines 875-1280 from index.tsx）
  - [x] 定数の移行（TIMING_ICONS, TIMING_LABELS）
  - [x] MorningIconのダッシュパターン修正
  - [x] 包括的テストスイート作成（7テストケース）
  - [x] index.tsxでのコンポーネント使用
  - [x] 不要なimportの削除

### 進行中タスク 🔄

- [ ] **現在のステップ**: git commit（SupplementCard抽出完了）

### 次回予定タスク 📋

#### Phase 2: フォーム関連コンポーネント抽出

- [ ] **SupplementForm コンポーネント抽出**

  - [ ] 新規サプリ追加フォーム部分の分離
  - [ ] バリデーションロジックの移行
  - [ ] フォームテストの作成
  - [ ] index.tsxでの使用と不要コード削除

- [ ] **UpdateModal コンポーネント抽出**
  - [ ] 編集モーダル部分の分離
  - [ ] state管理の整理
  - [ ] モーダルテストの作成

#### Phase 3: 状態管理とビジネスロジック分離

- [ ] **カスタムフック抽出**

  - [ ] useSupplementOperations
  - [ ] useSupplementFiltering
  - [ ] useNotificationHandling

- [ ] **ユーティリティ関数抽出**
  - [ ] 日付処理関数
  - [ ] データ変換関数
  - [ ] バリデーション関数

#### Phase 4: UI関連コンポーネント抽出

- [ ] **HeaderSection コンポーネント**
- [ ] **FilterSection コンポーネント**
- [ ] **SupplementList コンポーネント**
- [ ] **LoadingState コンポーネント**

#### Phase 5: 最終統合とクリーンアップ

- [ ] **index.tsx の最終クリーンアップ**
- [ ] **パフォーマンス最適化**
- [ ] **統合テストの追加**
- [ ] **ドキュメントの更新**

## 各フェーズの作業チェックリスト

### コンポーネント抽出の標準手順

1. **事前準備**

   - [ ] 対象コードブロックの特定と範囲確認
   - [ ] 依存関係の分析（props, state, imports）
   - [ ] 既存テストがある場合は影響範囲を確認

2. **コンポーネント作成**

   - [ ] 適切なディレクトリに新ファイル作成
   - [ ] TypeScript interfaceの定義
   - [ ] JSXロジックの移行
   - [ ] 必要なimportの追加
   - [ ] CSSスタイルの確認と移行

3. **テスト作成**

   - [ ] `__tests__`ディレクトリにテストファイル作成
   - [ ] 主要機能のテストケース実装
   - [ ] Props validation テスト
   - [ ] イベントハンドラーテスト
   - [ ] 条件付きレンダリングテスト

4. **統合と検証**

   - [ ] 元ファイル(index.tsx)での新コンポーネント使用
   - [ ] 不要なコードとimportの削除
   - [ ] テスト実行と修正
   - [ ] アプリケーション動作確認

5. **Git管理**
   - [ ] git add で変更ファイルをステージング
   - [ ] 適切なcommitメッセージでコミット
   - [ ] 必要に応じてブランチ作成・マージ

### エラー対応チェックリスト

- [ ] **TypeScriptエラー**

  - [ ] 型定義の確認と修正
  - [ ] インポートパスの確認
  - [ ] Props interfaceの整合性確認

- [ ] **テストエラー**

  - [ ] モックの設定確認
  - [ ] テストデータの妥当性確認
  - [ ] 非同期処理の適切な待機

- [ ] **スタイル不整合**
  - [ ] Tailwind classes の移行確認
  - [ ] CSS-in-JS スタイルの移行
  - [ ] レスポンシブデザインの確認

### 品質保証チェックリスト

- [ ] **コード品質**

  - [ ] ESLint エラーゼロ
  - [ ] TypeScript エラーゼロ
  - [ ] Prettier フォーマット適用

- [ ] **テストカバレッジ**

  - [ ] 新規コンポーネントのテスト作成
  - [ ] 既存テストの実行確認
  - [ ] エッジケースのテスト追加

- [ ] **パフォーマンス**
  - [ ] 不要なre-renderの回避
  - [ ] memoization の適切な使用
  - [ ] bundle size の確認

## ドキュメント更新チェックリスト

- [ ] **project-overview.yaml の更新**

  - [ ] 新規コンポーネントの追加
  - [ ] 責務分担の記録
  - [ ] 技術的負債の記録

- [ ] **README.md の更新**
  - [ ] 新しいコンポーネント構造の説明
  - [ ] テスト実行方法の更新
  - [ ] 開発手順の更新

## 注意事項とベストプラクティス

1. **段階的アプローチ**: 一度に大きな変更を行わず、小さな単位でコミット
2. **テストファースト**: 新機能追加時は必ずテストを先に作成
3. **型安全性**: TypeScriptの恩恵を最大限活用
4. **再利用性**: コンポーネントは再利用可能な設計を心がける
5. **パフォーマンス**: 不要なre-renderを避ける実装
6. **アクセシビリティ**: WAI-ARIAガイドラインに準拠

## 現在の状況確認

**最終更新**: SupplementCard コンポーネント抽出完了、MorningIcon修正完了
**次回実行予定**: git add & commit
