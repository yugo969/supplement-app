#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# TypeScriptå‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# lint-stagedå®Ÿè¡Œï¼ˆESLint + Prettierï¼‰
npx lint-staged

# E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ - ç·Šæ€¥å›é¿å¯èƒ½
if [ "$SKIP_E2E" = "1" ]; then
    echo "âš ï¸ E2Eãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ (SKIP_E2E=1)"
else
    echo "ğŸ§ª é‡è¦æ©Ÿèƒ½E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
    # å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œï¼ˆèªè¨¼ + æœç”¨è¨˜éŒ²å›å¸°ã®ã¿ï¼‰
    npx playwright test tests/e2e/auth tests/e2e/regression/dosage-tracking.spec.ts --project=chromium || {
        echo "âŒ E2Eãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ"
        echo "ğŸ’¡ ç·Šæ€¥æ™‚ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¹ã‚­ãƒƒãƒ—ã§ãã¾ã™:"
        echo "   SKIP_E2E=1 git commit -m \"ç·Šæ€¥ä¿®æ­£\""
        exit 1
    }
fi

echo "âœ… ã™ã¹ã¦ã®pre-commitãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸ"
