#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# TypeScript型チェック
npm run type-check

# lint-staged実行（ESLint + Prettier）
npx lint-staged

# E2Eテスト実行 - 緊急回避可能
if [ "$SKIP_E2E" = "1" ]; then
    echo "⚠️ E2Eテストをスキップしました (SKIP_E2E=1)"
else
    echo "🧪 重要機能E2Eテスト実行中..."
    # 安定したテストのみ実行（認証 + 服用記録回帰のみ）
    npx playwright test tests/e2e/auth tests/e2e/regression/dosage-tracking.spec.ts --project=chromium || {
        echo "❌ E2Eテストが失敗しました"
        echo "💡 緊急時は以下のコマンドでスキップできます:"
        echo "   SKIP_E2E=1 git commit -m \"緊急修正\""
        exit 1
    }
fi

echo "✅ すべてのpre-commitチェックが完了しました"
